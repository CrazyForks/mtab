import{_ as e,r as a,b as l,c as t,d as i,e as s,k as r,h as n,V as o,av as d,S as u,H as p,G as g,g as c,x as m,m as h}from"./index.1717935479334.js";const v={class:"SearchEngine"},f={class:"p-4 bg-white rounded-lg overflow-hidden flex flex-wrap gap-4"},w={class:"ml-auto"},_={class:"mt-4 p-4 bg-white rounded-lg overflow-hidden w-full"},b=["src"],x={key:1,title:"无法预览",style:{width:"40px",height:"40px",margin:"auto"},src:"/dist/assets/file.1717935479334.svg"},y={key:0},k={key:1},z=["download","href"];var C=e({__name:"file",setup(e){const C=a({page:1,limit:20,total:0,refresh(e){C.value.page=e,O()},sizes(e){C.value.limit=e,O()}}),V=()=>{o.confirm("扫描本地需要消耗更多的资源，需要耐心等待，期间请勿离开","温馨提示").then((e=>{const a=d.service({fullscreen:!0,text:"扫描中"});u({url:"/File/scanLocal",method:"post"}).then((e=>{C.value.refresh(1),p.success(e.msg)})).finally((e=>{a.close()}))})).catch((e=>{}))},j=a({path:"",user_id:""}),F=a("");let S=a(!1);const I=a([]),O=()=>{I.value=[],u({url:"/File/list",method:"post",data:{search:j.value,limit:C.value.limit,page:C.value.page}}).then((e=>{S.value=!0,I.value=e.data.data,Object.assign(C.value,e.data)}))};return O(),(e,a)=>{const d=l("el-input"),S=l("el-button"),U=l("el-table-column"),D=l("el-tag"),E=l("el-table"),G=l("el-pagination");return t(),i("div",v,[s("div",f,[r(d,{modelValue:j.value.path,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value.path=e),style:{width:"200px"},placeholder:"图片地址搜索",clearable:""},null,8,["modelValue"]),r(d,{modelValue:j.value.user_id,"onUpdate:modelValue":a[1]||(a[1]=e=>j.value.user_id=e),style:{width:"200px"},placeholder:"用户ID搜索",clearable:""},null,8,["modelValue"]),r(S,{onClick:O,type:"primary"},{default:n((()=>[g("搜索")])),_:1}),s("div",w,[r(S,{type:"danger",onClick:V},{default:n((()=>[g("扫描本地文件入库 ")])),_:1})])]),s("div",_,[r(E,{ref_key:"table",ref:F,height:"calc(100vh - 200px)",data:I.value},{default:n((()=>[r(U,{prop:"name",label:"预览",align:"center",width:"90"},{default:n((e=>[["image/png","image/jpg","image/jpeg","image/gif","image/webp","image/svg","image/svg+xml","image/vnd.microsoft.icon","image/x-icon"].indexOf(e.row.mime_type)>=0?(t(),i("img",{key:0,style:{width:"40px",height:"40px",margin:"auto"},src:e.row.path},null,8,b)):(t(),i("img",x))])),_:1}),r(U,{prop:"status",label:"上传用户",align:"center",width:"180"},{default:n((e=>[e.row.user?(t(),i("div",y,[e.row.user.nickname?(t(),c(D,{key:0},{default:n((()=>[g(m(e.row.user.nickname),1)])),_:2},1024)):e.row.user_id?(t(),i("span",k,"id:"+m(e.row.user_id),1)):h("",!0)])):h("",!0)])),_:1}),r(U,{prop:"path","show-overflow-tooltip":"",label:"文件路径",align:"center","min-width":"260"}),r(U,{prop:"mime_type",label:"文件类型",width:"200px",align:"center"}),r(U,{prop:"status",label:"文件大小",align:"center",width:"180"},{default:n((e=>[g(m((e.row.size/1024).toFixed(2))+"kb ",1)])),_:1}),r(U,{prop:"create_time",label:"创建时间",align:"center",width:"200"}),r(U,{fixed:"right",label:"操作",align:"center",width:"200"},{default:n((e=>[s("a",{download:e.row.path,class:"el-button el-button--small el-button--primary",target:"_blank",href:e.row.path},"下载",8,z),r(S,{type:"danger",size:"small",onClick:a=>{return l=e.row.id,void o.confirm("是否删除","删除提示").then((e=>{u({url:"/File/del",method:"post",data:{ids:[l]}}).then((e=>{p.success(e.msg),O()}))}));var l}},{default:n((()=>[g("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r(G,{"page-size":C.value.limit,"current-page":C.value.page,onSizeChange:C.value.sizes,onCurrentChange:C.value.refresh,"page-sizes":[20,30,40,50,100],class:"mt-6",layout:"sizes,total,prev,pager,jumper",total:C.value.total},null,8,["page-size","current-page","onSizeChange","onCurrentChange","total"])])])}}},[["__scopeId","data-v-76c272d5"]]);export{C as default};
