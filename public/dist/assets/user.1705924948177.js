import{r as e,b as a,c as l,d as t,e as o,k as r,h as i,X as n,a1 as d,g as u,m as s,a2 as p,L as m}from"./index.1705924948177.js";const c={class:"userManager"},g={class:"p-4 bg-white rounded-lg overflow-hidden flex flex-wrap gap-4"},v={class:"mt-4 p-4 bg-white rounded-lg overflow-hidden w-full"},h={__name:"user",setup(h){const f={mail:"",password:"",manager:0},_=e(Object.assign({},f)),b=e(!1),w=e({email:""}),V=()=>{_.value=e({mail:"",password:"",manager:""}).value,b.value=!0},y=()=>{n({url:"/admin/userUpdate",method:"post",data:_.value}).then((e=>{1===e.code&&(b.value=!1,x()),m.success(e.msg)}))},C=e({current_page:1,per_page:50,total:0,refresh(e){C.value.current_page=e,x()},sizes(e){C.value.per_page=e,x()}}),k=e([]),z={order:"desc",prop:"id"},x=()=>{n({url:"/admin/UserList",method:"post",data:{search:w.value,page:C.value.current_page,limit:C.value.per_page,sort:z}}).then((e=>{let a=e.data;k.value=a.data,Object.assign(C.value,a)}))},U=({column:e,prop:a,order:l})=>{let t="asc";"descending"===l&&(t="desc"),z.order=t,z.prop=a,x()};return x(),(e,h)=>{const z=a("el-input"),j=a("el-button"),I=a("el-table-column"),O=a("el-tag"),S=a("el-table"),D=a("el-pagination"),L=a("el-form-item"),P=a("el-option"),M=a("el-select"),X=a("el-form"),q=a("el-link"),A=a("el-dialog");return l(),t("div",c,[o("div",g,[r(z,{modelValue:w.value.email,"onUpdate:modelValue":h[0]||(h[0]=e=>w.value.email=e),style:{width:"200px"},placeholder:"邮箱",clearable:""},null,8,["modelValue"]),r(j,{onClick:x,type:"primary"},{default:i((()=>[d("搜索")])),_:1}),r(j,{type:"danger",onClick:V},{default:i((()=>[d("添加新用户")])),_:1})]),o("div",v,[r(S,{onSortChange:U,data:k.value,height:"calc(100vh - 203px)",he:""},{default:i((()=>[r(I,{prop:"id",sortable:"custom",label:"用户ID",align:"center","min-width":"100"}),r(I,{prop:"mail",label:"邮箱",align:"center","min-width":"200"}),r(I,{prop:"login_ip",label:"登录IP",align:"center","min-width":"200"}),r(I,{prop:"login_time",sortable:"custom",label:"上次登录时间",align:"center","min-width":"200"}),r(I,{prop:"register_ip",label:"注册IP",align:"center","min-width":"200"}),r(I,{prop:"create_time",sortable:"custom",label:"注册时间",align:"center","min-width":"200"}),r(I,{prop:"login_fail_count",sortable:"custom",label:"登录失败次数",align:"center","min-width":"150"}),r(I,{prop:"manager",label:"权限",align:"center","min-width":"100"},{default:i((e=>[0===e.row.manager?(l(),u(O,{key:0,type:"info",size:"small"},{default:i((()=>[d("用户")])),_:1})):s("",!0),1===e.row.manager?(l(),u(O,{key:1,type:"danger",size:"small"},{default:i((()=>[d("管理员")])),_:1})):s("",!0)])),_:1}),r(I,{fixed:"right",label:"操作","min-width":"80",align:"center"},{default:i((e=>[r(j,{type:"primary",onClick:a=>{return l=e.row,_.value=Object.assign({},f,l),void(b.value=!0);var l},size:"small"},{default:i((()=>[d("操作")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r(D,{"page-sizes":[15,20,30,40,50,100],onCurrentChange:C.value.refresh,class:"mt-6",layout:"sizes,total,prev,pager,jumper","page-size":C.value.per_page,onSizeChange:C.value.sizes,total:C.value.total},null,8,["onCurrentChange","page-size","onSizeChange","total"])]),r(A,{title:"编辑用户",modelValue:b.value,"onUpdate:modelValue":h[6]||(h[6]=e=>b.value=e),width:600,"align-center":"","close-on-click-modal":!1},{default:i((()=>[r(X,{modelValue:_.value,"onUpdate:modelValue":h[4]||(h[4]=e=>_.value=e),"label-width":"100px","label-position":"top"},{default:i((()=>[r(L,{label:"邮箱"},{default:i((()=>[r(z,{modelValue:_.value.mail,"onUpdate:modelValue":h[1]||(h[1]=e=>_.value.mail=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),r(L,{label:"设置密码"},{default:i((()=>[r(z,{modelValue:_.value.password,"onUpdate:modelValue":h[2]||(h[2]=e=>_.value.password=e),placeholder:"请设置新密码,否则请留空"},null,8,["modelValue"])])),_:1}),r(L,{label:"是否管理员"},{default:i((()=>[r(M,{modelValue:_.value.manager,"onUpdate:modelValue":h[3]||(h[3]=e=>_.value.manager=e),class:"w-full",placeholder:"请选择"},{default:i((()=>[r(P,{label:"用户",value:0}),r(P,{label:"管理员",value:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"]),r(j,{class:"mt-4 w-full",onClick:y,type:"primary",size:"large"},{default:i((()=>[d("提交")])),_:1}),_.value.id?(l(),u(q,{key:0,class:"mt-6",type:"danger",onClick:h[5]||(h[5]=e=>(async e=>{try{await p.confirm("您确定删除当前用户？删除后数据将全部删除！","危险操作警告"),1===(await n({url:"/admin/userDelete",method:"post",data:{id:e}})).code&&(m.success("已删除当前用户所有数据"),b.value=!1,x())}catch(a){m.info("操作已取消")}})(_.value.id))},{default:i((()=>[d("删除用户")])),_:1})):s("",!0)])),_:1},8,["modelValue"])])}}};export{h as default};
