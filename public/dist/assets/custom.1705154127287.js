import{r as a,u as l,w as e,p as t,o as u,b as s,c as o,d,e as i,k as r,h as n,$ as c,j as v,S as p,i as m,v as h,ak as f,m as g,V as w,a8 as x}from"./index.1705154127287.js";import{u as b}from"./appSide.1705154127287.js";const _={class:"customBox"},y={class:"flex gap-4 w-full"},V=i("span",{class:"ml-6 text-xs text-red-500"},"开启后会以程序内窗口形式打开，可能存在第三方禁止此方式访问",-1),k={class:"flex gap-4 w-full"},j={class:"col-span-2 h-16 flex"},U={class:"iconsel absolute z-10"},C=["src"],I={class:"iconsel absolute z-10"},L=["src"],z={class:"w-1/2 pl-20"},E={__name:"custom",props:{data:{type:Object}},setup(E){var O;const P=E,S=a(!1),A=a(1),B=a=>{A.value=a},$=a(!1),q=l(),D={id:"",name:"",src:"",url:"",size:"1x1",type:"icon",sort:99999,app:0},F=a(Object.assign({},D));(null==(O=P.data)?void 0:O.id)&&(F.value=P.data);e(F.value,(a=>{}));const G=async()=>{var a;$.value=!0;try{const a=await w({url:"/linkStore/getIcon",method:"post",data:{url:F.value.url}});if(1===a.code)return F.value.src=a.data.src,F.value.name=a.data.name,void($.value=!1)}catch(l){}try{const l=await w({url:"/api/getIcon",method:"post",data:{url:F.value.url}});1===l.code?(F.value.src=l.data.src,l.data.name&&(F.value.name=null==(a=l.data)?void 0:a.name.substring(0,20))):x.error("获取网站数据失败,请手动设置")}catch(l){console.error("Error fetching data:",l),x.error("获取网站数据失败,请手动设置")}$.value=!1},H=a=>{1===a.code?F.value.src=a.data.url:x.error(a.msg)},J=async()=>{if(""===F.value.name||""===F.value.url)return x.warning("请设置标签信息");if($.value=!0,"tab"===F.value.url.slice(0,3)||1===F.value.app||"http"!==F.value.url.slice(0,4)&&(F.value.url="http://"+F.value.url),2===A.value)try{const a=await w({url:"api/getIcon",method:"post",data:{avatar:F.value.name}});1===a.code&&(F.value.src=a.data.src)}catch(a){}""===F.value.id?(F.value.id=b(),q.state.link.push(F.value),q.commit("updateLink")):q.commit("setLink",F.value),$.value=!1,t.emit("closePlugin"),S.value=!1};return t.on("linkEdit",((a=!1)=>{F.value=Object.assign({},D),a&&(F.value=a),S.value=!0})),u((()=>{t.off("linkEdit".open)})),(a,l)=>{const e=s("el-input"),t=s("el-button"),u=s("el-form-item"),w=s("el-switch"),x=s("el-upload"),b=s("el-icon"),E=s("el-form");return o(),d("div",_,[i("div",null,[r(E,{"label-position":"right","label-width":"80px",class:"w-full pr-4 mt-4"},{default:n((()=>[r(u,{label:"标签网址"},{default:n((()=>[i("div",y,[r(e,{class:"input_div w-full",modelValue:F.value.url,"onUpdate:modelValue":l[0]||(l[0]=a=>F.value.url=a),"show-word-limit":"",maxlength:"255",placeholder:"请输入带http开头的网址"},null,8,["modelValue"]),r(t,{type:"primary",onClick:G,loading:$.value},{default:n((()=>[c("获取图标")])),_:1},8,["loading"])])])),_:1}),r(u,{label:"标签名称"},{default:n((()=>[r(e,{maxlength:"100",class:"input_div","show-word-limit":"",modelValue:F.value.name,"onUpdate:modelValue":l[1]||(l[1]=a=>F.value.name=a),placeholder:"标签名称"},null,8,["modelValue"])])),_:1}),r(u,{label:"标签简介"},{default:n((()=>[r(e,{class:"input_div",maxlength:"200","show-word-limit":"",type:"textarea",rows:"4",modelValue:F.value.tips,"onUpdate:modelValue":l[2]||(l[2]=a=>F.value.tips=a),placeholder:"简单介绍标签（非必填）"},null,8,["modelValue"])])),_:1}),r(u,{label:"网页APP"},{default:n((()=>[r(w,{"active-value":1,"inactive-value":0,modelValue:F.value.app,"onUpdate:modelValue":l[3]||(l[3]=a=>F.value.app=a)},null,8,["modelValue"]),V])),_:1}),r(u,{label:"标签Logo"},{default:n((()=>[i("div",k,[r(e,{class:"input_div",modelValue:F.value.src,"onUpdate:modelValue":l[4]||(l[4]=a=>F.value.src=a),placeholder:"请上传或粘贴标签图标地址"},null,8,["modelValue"]),r(x,{class:"upload-demo","show-file-list":!1,"on-success":H,action:v(p)+v(q).state.site.upload},{default:n((()=>[r(t,{type:"primary"},{default:n((()=>[c("上传")])),_:1})])),_:1},8,["action"])])])),_:1}),r(u,{label:"选择Logo"},{default:n((()=>[i("div",j,[F.value.src?(o(),d("div",{key:0,class:"relative",onClick:l[5]||(l[5]=a=>B(1))},[m(i("div",U,[r(b,null,{default:n((()=>[r(v(f))])),_:1})],512),[[h,1===A.value]]),i("img",{src:F.value.src,class:"rounded-2xl mr-3 bg-slate-100",style:{width:"60px",height:"60px"},alt:""},null,8,C)])):g("",!0),F.value.name?(o(),d("div",{key:1,class:"relative",onClick:l[6]||(l[6]=a=>B(2))},[m(i("div",I,[r(b,null,{default:n((()=>[r(v(f))])),_:1})],512),[[h,2===A.value]]),i("img",{src:v(p)+"/api/renderIco?seed="+F.value.name,class:"rounded-2xl mr-3 bg-slate-100",style:{width:"60px",height:"60px"},alt:""},null,8,L)])):g("",!0)])])),_:1})])),_:1}),i("div",z,[r(t,{type:"primary",class:"w-40",onClick:J},{default:n((()=>[c("保存")])),_:1})])])])}}};export{E as default};
