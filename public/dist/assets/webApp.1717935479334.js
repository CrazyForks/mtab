import{r as e,S as a,b as s,K as l,c as t,d as n,e as i,n as c,i as d,g as r,m as o,F as u,f as m,v as p,h as v,x as y,G as f,k as x,j as k,ax as _,T as g,V as b,av as w,H as C}from"./index.1717935479334.js";import{a as h}from"./dialog.1717935479334.js";const z={class:"manager-webApp p-0 rounded-lg"},I={class:"card-swipe"},j={class:"card-swipe-item"},T={class:"p-4 mt-4 bg-white rounded-lg h-full webappItem"},S={class:"card-box"},A={class:"card-box-item"},B={class:"flex"},$=["src"],H={class:"ml-6 flex-1"},L={class:"flex justify-between"},F={class:"text-base"},G=i("span",null,"更新版本",-1),K={class:"text-sm mt-2 text-gray-500"},M={class:"flex mt-4"},U={class:"card-box"},V={class:"card-box-item"},q={class:"flex"},D=["src"],E={class:"ml-6 flex-1"},J={class:"flex justify-between items-center"},N={class:"text-base"},O={class:"flex ml-auto items-center"},P={key:0,class:"card-price mr-4 text-blue-500 text-sm"},Q={key:1,class:"card-price mr-4 text-green-500 text-sm"},R={key:2,class:"card-price mr-4 text-red-500 text-sm"},W={class:"text-sm mt-2 text-gray-500"},X={__name:"webApp",setup(X){const Y=e(!0),Z=e(1),ee=e=>{Z.value=e},ae=e([]),se=e([]),le=()=>{a({url:"/admin.Index/localCard"}).then((e=>{1===e.code&&(se.value=e.data),Y.value=!1}))};le(),a({url:"/admin.Index/cardList"}).then((e=>{1===e.code&&(ae.value=e.data)}));const te=async e=>{await a({url:"/admin.Index/stopCard",method:"post",data:{name_en:e.name_en}}),le()},ne=e=>!!se.value.find((a=>a.name_en===e.name_en)),ie=e=>{const a=ae.value.find((a=>a.name_en===e.name_en));if(a&&a.version>e.version)return!0},ce=async(e,s="install")=>{if("update"===s)try{const a=ae.value.find((a=>a.name_en===e.name_en));a&&await b.confirm(`\n              <div>\n                <pre style="white-space: pre-line;">\n                  ${a.commit}\n                </pre>\n              </div>\n              `,`本次版本更新内容（${a.name}：v${a.version}）`,{dangerouslyUseHTMLString:!0,confirmButtonText:"确定更新"})}catch(t){return void C.info("已取消更新")}const l=w.service({fullscreen:!0,text:"安装中很快就好，请耐心等待···"});a({url:"/admin.Index/installCard",method:"post",data:{type:s,name_en:e.name_en}}).then((e=>{1===e.code?(C.success(e.msg),le()):C.error(e.msg)})).finally((e=>{l.close()}))};return(e,X)=>{const de=s("el-empty"),re=s("el-tag"),oe=s("el-button"),ue=l("loading");return t(),n("div",z,[i("div",I,[i("div",j,[i("button",{class:c({selSwipe:1===Z.value}),onClick:X[0]||(X[0]=e=>ee(1))},"已安装",2),i("button",{class:c({selSwipe:2===Z.value}),onClick:X[1]||(X[1]=e=>ee(2))},"卡片商店",2)])]),d((t(),n("div",T,[d(i("div",null,[Y.value||0!==se.value.length?o("",!0):(t(),r(de,{key:0,description:"快去卡片商店安装卡片组件吧！"})),i("div",S,[(t(!0),n(u,null,m(se.value,((e,s)=>(t(),r(g,{key:s},{default:v((()=>[i("div",A,[i("div",B,[i("img",{class:"card-box-item-logo",src:e.src,alt:""},null,8,$),i("div",H,[i("div",L,[i("div",F,[i("span",null,y(e.name),1),1===e.status?(t(),r(re,{key:0,round:"",class:"ml-4"},{default:v((()=>[f(" 已启用 ")])),_:1})):o("",!0),0===e.status?(t(),r(re,{key:1,round:"",class:"ml-4",type:"warning"},{default:v((()=>[f(" 已关闭 ")])),_:1})):o("",!0)]),ie(e)?(t(),r(oe,{key:0,onClick:a=>ce(e,"update"),type:"primary",size:"small",class:"rounded-full"},{default:v((()=>[G])),_:2},1032,["onClick"])):(null==e?void 0:e.setting)?(t(),r(oe,{key:1,size:"small",round:"",style:{"background-color":"#2980b9",border:"1px solid #2980b9"},rounded:"",type:"warning",onClick:a=>(e=>{new h({title:e.name+"- 参数配置",ico:e.src,url:e.setting,custom:{minimization:0,maximize:0}}).open()})(e)},{default:v((()=>[f("设置 ")])),_:2},1032,["onClick"])):o("",!0)]),i("div",K,y(e.tips),1)])]),i("div",M,[x(re,{type:"danger",class:"mr-3"},{default:v((()=>[f("热度："+y(k(_)(e.install_num)),1)])),_:2},1024),x(re,{class:"mr-3"},{default:v((()=>[f("版本：v"+y(e.version),1)])),_:2},1024),e.status?(t(),r(oe,{key:0,size:"small",type:"info",onClick:a=>te(e)},{default:v((()=>[f("停止使用")])),_:2},1032,["onClick"])):o("",!0),e.status?o("",!0):(t(),r(oe,{key:1,size:"small",type:"success",onClick:s=>(async e=>{try{await a({url:"/admin.Index/startCard",method:"post",data:{name_en:e.name_en}})}catch(s){}le()})(e)},{default:v((()=>[f("开启访问")])),_:2},1032,["onClick"])),x(oe,{size:"small",type:"danger",onClick:s=>(async e=>{try{await b.confirm("您即将删除当前插件，请谨慎操作！","危险警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning","custom-style":{width:"500px"}})}catch(t){return!1}await te(e);const s=w.service({fullscreen:!0,text:"很快就好，请耐心等待···"}),l=await a({url:"/admin.Index/uninstallCard",method:"post",data:{name_en:e.name_en}});1===l.code&&(C.success(l.msg),le()),s.close()})(e)},{default:v((()=>[f("卸载")])),_:2},1032,["onClick"])])])])),_:2},1024)))),128))])],512),[[p,1===Z.value]]),d(i("div",null,[Y.value||0!==ae.value.length?o("",!0):(t(),r(de,{key:0,description:"当前商城没有在线卡片组件！"})),i("div",U,[(t(!0),n(u,null,m(ae.value,((e,a)=>(t(),r(g,{key:a},{default:v((()=>[i("div",V,[i("div",q,[i("img",{class:"card-box-item-logo",src:e.src,alt:""},null,8,D),i("div",E,[i("div",J,[i("span",N,y(e.name),1),x(re,{size:"small",class:"ml-4"},{default:v((()=>[f("版本：v"+y(e.version),1)])),_:2},1024),i("div",O,[e.appAuth?(t(),n("div",P,"已获得")):"0.00"===e.price?(t(),n("div",Q,"未获得")):(t(),n("div",R,"¥ "+y(e.price),1)),ne(e)?(t(),r(oe,{key:3,size:"small",type:"success"},{default:v((()=>[f("已安装")])),_:1})):(t(),r(oe,{key:4,size:"small",type:"primary",onClick:a=>ce(e,"install")},{default:v((()=>[f("安装")])),_:2},1032,["onClick"]))])]),i("div",W,y(e.tips),1)])])])])),_:2},1024)))),128))])],512),[[p,2===Z.value]])])),[[ue,Y.value]])])}}};export{X as default};
