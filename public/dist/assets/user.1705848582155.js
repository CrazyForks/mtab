import{r as e,b as l,c as a,d as t,e as o,k as r,h as i,X as n,a1 as u,g as d,m as s,L as p}from"./index.1705848582155.js";const m={class:"userManager"},c={class:"p-4 bg-white rounded-lg overflow-hidden flex flex-wrap gap-4"},g={class:"mt-4 p-4 bg-white rounded-lg overflow-hidden w-full"},v={__name:"user",setup(v){const h={mail:"",password:"",manager:0},f=e(Object.assign({},h)),b=e(!1),_=e({email:""}),w=()=>{f.value=e({mail:"",password:"",manager:""}).value,b.value=!0},V=()=>{n({url:"/admin/userUpdate",method:"post",data:f.value}).then((e=>{1===e.code&&(b.value=!1,k()),p.success(e.msg)}))},y=e({current_page:1,per_page:50,total:0,refresh(e){y.value.current_page=e,k()},sizes(e){y.value.per_page=e,k()}}),z=e([]),C={order:"desc",prop:"id"},k=()=>{n({url:"/admin/UserList",method:"post",data:{search:_.value,page:y.value.current_page,limit:y.value.per_page,sort:C}}).then((e=>{let l=e.data;z.value=l.data,Object.assign(y.value,l)}))},x=({column:e,prop:l,order:a})=>{let t="asc";"descending"===a&&(t="desc"),C.order=t,C.prop=l,k()};return k(),(e,n)=>{const p=l("el-input"),v=l("el-button"),C=l("el-table-column"),U=l("el-tag"),j=l("el-table"),I=l("el-pagination"),O=l("el-form-item"),S=l("el-option"),L=l("el-select"),P=l("el-form"),D=l("el-dialog");return a(),t("div",m,[o("div",c,[r(p,{modelValue:_.value.email,"onUpdate:modelValue":n[0]||(n[0]=e=>_.value.email=e),style:{width:"200px"},placeholder:"邮箱",clearable:""},null,8,["modelValue"]),r(v,{onClick:k,type:"primary"},{default:i((()=>[u("搜索")])),_:1}),r(v,{type:"danger",onClick:w},{default:i((()=>[u("添加新用户")])),_:1})]),o("div",g,[r(j,{onSortChange:x,data:z.value,height:"calc(100vh - 203px)",he:""},{default:i((()=>[r(C,{prop:"id",sortable:"custom",label:"用户ID",align:"center","min-width":"100"}),r(C,{prop:"mail",label:"邮箱",align:"center","min-width":"200"}),r(C,{prop:"login_ip",label:"登录IP",align:"center","min-width":"200"}),r(C,{prop:"login_time",sortable:"custom",label:"上次登录时间",align:"center","min-width":"200"}),r(C,{prop:"register_ip",label:"注册IP",align:"center","min-width":"200"}),r(C,{prop:"create_time",sortable:"custom",label:"注册时间",align:"center","min-width":"200"}),r(C,{prop:"login_fail_count",sortable:"custom",label:"登录失败次数",align:"center","min-width":"150"}),r(C,{prop:"manager",label:"权限",align:"center","min-width":"100"},{default:i((e=>[0===e.row.manager?(a(),d(U,{key:0,type:"info",size:"small"},{default:i((()=>[u("用户")])),_:1})):s("",!0),1===e.row.manager?(a(),d(U,{key:1,type:"danger",size:"small"},{default:i((()=>[u("管理员")])),_:1})):s("",!0)])),_:1}),r(C,{fixed:"right",label:"操作","min-width":"80",align:"center"},{default:i((e=>[r(v,{type:"primary",onClick:l=>{return a=e.row,f.value=Object.assign({},h,a),void(b.value=!0);var a},size:"small"},{default:i((()=>[u("操作")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r(I,{"page-sizes":[15,20,30,40,50,100],onCurrentChange:y.value.refresh,class:"mt-6",layout:"sizes,total,prev,pager,jumper","page-size":y.value.per_page,onSizeChange:y.value.sizes,total:y.value.total},null,8,["onCurrentChange","page-size","onSizeChange","total"])]),r(D,{title:"编辑用户",modelValue:b.value,"onUpdate:modelValue":n[5]||(n[5]=e=>b.value=e),width:600,"close-on-click-modal":!1},{default:i((()=>[r(P,{modelValue:f.value,"onUpdate:modelValue":n[4]||(n[4]=e=>f.value=e),"label-width":"100px","label-position":"top"},{default:i((()=>[r(O,{label:"邮箱"},{default:i((()=>[r(p,{modelValue:f.value.mail,"onUpdate:modelValue":n[1]||(n[1]=e=>f.value.mail=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),r(O,{label:"设置密码"},{default:i((()=>[r(p,{modelValue:f.value.password,"onUpdate:modelValue":n[2]||(n[2]=e=>f.value.password=e),placeholder:"请设置新密码,否则请留空"},null,8,["modelValue"])])),_:1}),r(O,{label:"是否管理员"},{default:i((()=>[r(L,{modelValue:f.value.manager,"onUpdate:modelValue":n[3]||(n[3]=e=>f.value.manager=e),class:"w-full",placeholder:"请选择"},{default:i((()=>[r(S,{label:"用户",value:0}),r(S,{label:"管理员",value:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"]),r(v,{class:"mt-4 w-full",onClick:V,type:"primary",size:"large"},{default:i((()=>[u("提交")])),_:1})])),_:1},8,["modelValue"])])}}};export{v as default};
