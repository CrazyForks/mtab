import{r as l,aw as e,u as a,J as s,o as t,b as u,c as o,d as i,e as r,k as d,h as n,G as c,j as p,U as v,i as m,v as g,aH as b,q as h,p as f,m as k,F as x,f as _,g as w,x as y,S as V,H as C}from"./index.1717935479334.js";import{u as U}from"./appSide.1717935479334.js";import{T as j}from"./textIcon.1717935479334.js";import"./dialog.1717935479334.js";const z={class:"customBox pb-6 overflow-y-scroll"},I={class:"flex gap-4 w-full"},G={class:"flex gap-4 w-full"},L={class:"col-span-2 h-16 flex"},R={class:"iconsel absolute z-20"},S={class:"iconsel absolute z-10"},E=["src"],O={class:"iconsel absolute z-10"},B=["src"],H={class:"bgColorPicker"},P=["onClick"],T={key:0,class:"touming"},q={key:0,style:{"font-size":"20px",color:"#ff0000",inset:"-5px 3px",position:"relative"}},F={key:0,style:{"font-size":"20px",color:"#d9d9d9",inset:"-5px 3px",position:"relative"}},J=r("span",{class:"ml-6 text-xs text-red-500"},"内嵌窗口形式打开，第三方可能不兼容",-1),W={class:"whitespace-break-spaces",style:{"line-height":"16px"}},A={class:"w-full xs:pl-20 mt-6 flex"},D={__name:"custom",props:{data:{type:Object}},setup(D){var K;const M=D,N=l(!1),Q={userid:e("user_id"),token:e("token"),"Up-Type":"icon"},X=window.innerWidth,Y=["rgba(0,0,0,0)","#fff","rgb(22, 129, 255)","rgb(251, 190, 35)","rgb(252, 69, 72)","rgb(75, 60, 54)","rgb(125, 172, 104)","rgb(2, 51, 115)","rgb(200, 172, 112)","rgb(55, 33, 40)","rgb(5, 64, 146)"],Z=l(!1),$=l(1),ll=l=>{$.value=l},el=l(!1),al=a(),sl={id:"",name:"",src:"",url:"",size:"1x1",type:"icon",sort:99999,app:0,tips:"",bgColor:null,pageGroup:""},tl=l(Object.assign({},sl));(null==(K=M.data)?void 0:K.id)&&(tl.value=M.data);const ul=async()=>{var l;el.value=!0;try{const l=await V({url:"/LinkStore/getIcon",method:"post",data:{url:tl.value.url}});if(1===l.code)return tl.value.src=l.data.src,tl.value.name=l.data.name,void(el.value=!1)}catch(e){}try{const e=await V({url:"/api/getIcon",method:"post",data:{url:tl.value.url}});1===e.code?(tl.value.src=e.data.src,e.data.name&&(tl.value.name=null==(l=e.data)?void 0:l.name.substring(0,20))):C.error(e.msg)}catch(e){console.error("Error fetching data:",e),C.error("获取网站数据失败,请手动设置")}el.value=!1},ol=l=>{1===l.code?tl.value.src=l.data.url:C.warning(l.msg)},il=async()=>{if(""===tl.value.name||""===tl.value.url)return C.warning("请设置标签信息");if(el.value=!0,"tab"===tl.value.url.slice(0,3)||1===tl.value.app||"http"!==tl.value.url.slice(0,4)&&(tl.value.url="http://"+tl.value.url),2===$.value)try{const l=await V({url:"/api/getIcon",method:"post",data:{avatar:tl.value.url}});1===l.code&&(tl.value.src=l.data.src)}catch(l){}""===tl.value.id?(N.value&&V({url:"/LinkStore/push",method:"post",data:tl.value}).finally((l=>{})),tl.value.id=U(),tl.value.pageGroup=al.state.pageGroup,al.state.link.push(tl.value),al.commit("updateLink")):(al.commit("setLink",tl.value),s.emit("refreshGroup")),el.value=!1,s.emit("closePlugin"),Z.value=!1};return s.on("linkEdit",((l={})=>{l&&(tl.value=Object.assign({},sl)),Z.value=!0})),t((()=>{s.off("linkEdit".open)})),(l,e)=>{const a=u("el-input"),s=u("el-button"),t=u("el-form-item"),V=u("el-upload"),C=u("el-icon"),U=u("el-color-picker"),D=u("el-switch"),K=u("el-checkbox"),M=u("el-form");return o(),i("div",z,[r("div",null,[d(M,{"label-position":p(X)<500?"top":"right","label-width":"80px",class:"w-full mt-4"},{default:n((()=>[d(t,{label:"标签网址"},{default:n((()=>[r("div",I,[d(a,{class:"input_div w-full",modelValue:tl.value.url,"onUpdate:modelValue":e[0]||(e[0]=l=>tl.value.url=l),"show-word-limit":"",maxlength:"255",placeholder:"请输入带http开头的网址"},null,8,["modelValue"]),d(s,{type:"primary",onClick:ul,loading:el.value},{default:n((()=>[c("获取图标")])),_:1},8,["loading"])])])),_:1}),d(t,{label:"标签名称"},{default:n((()=>[d(a,{maxlength:"100",class:"input_div","show-word-limit":"",modelValue:tl.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>tl.value.name=l),placeholder:"标签名称"},null,8,["modelValue"])])),_:1}),d(t,{label:"标签简介"},{default:n((()=>[d(a,{class:"input_div",maxlength:"200","show-word-limit":"",rows:"1",modelValue:tl.value.tips,"onUpdate:modelValue":e[2]||(e[2]=l=>tl.value.tips=l),placeholder:"简单介绍标签（非必填）"},null,8,["modelValue"])])),_:1}),d(t,{label:"标签图标"},{default:n((()=>[r("div",G,[d(a,{class:"input_div",modelValue:tl.value.src,"onUpdate:modelValue":e[3]||(e[3]=l=>tl.value.src=l),placeholder:"请上传或粘贴标签图标地址,支持png,jpg,ico,svg,webp格式"},null,8,["modelValue"]),d(V,{class:"upload-demo","show-file-list":!1,"on-success":ol,headers:Q,action:p(v)+p(al).state.site.upload},{default:n((()=>[d(s,{type:"danger"},{default:n((()=>[c("手动上传")])),_:1})])),_:1},8,["action"])])])),_:1}),d(t,{label:"选择图标"},{default:n((()=>[r("div",L,[tl.value.src&&/^txt:/.test(tl.value.src)?(o(),i("div",{key:0,class:"relative mr-3",onClick:e[4]||(e[4]=l=>ll(1))},[m(r("div",R,[d(C,null,{default:n((()=>[d(p(b))])),_:1})],512),[[g,1===$.value]]),d(j,{style:{width:"60px",height:"60px"},text:tl.value.src,bgColor:tl.value.bgColor},null,8,["text","bgColor"])])):tl.value.src&&/^(\/|http)/.test(tl.value.src)?(o(),i("div",{key:1,class:"relative",onClick:e[5]||(e[5]=l=>ll(1))},[m(r("div",S,[d(C,null,{default:n((()=>[d(p(b))])),_:1})],512),[[g,1===$.value]]),r("img",{src:p(h)(tl.value.src),class:"mr-3",style:f({width:"60px",height:"60px",backgroundColor:tl.value.bgColor,borderRadius:"var(--iconRadius)"})},null,12,E)])):k("",!0),r("div",{class:"relative",onClick:e[6]||(e[6]=l=>ll(2))},[m(r("div",O,[d(C,null,{default:n((()=>[d(p(b))])),_:1})],512),[[g,2===$.value]]),r("img",{src:p(v)+"/api/renderIco?seed="+encodeURI(tl.value.url),class:"mr-3 bg-slate-100",style:{width:"60px",height:"60px","border-radius":"var(--iconRadius)"}},null,8,B)])])])),_:1}),d(t,{label:"背景颜色"},{default:n((()=>[r("ul",H,[(o(),i(x,null,_(Y,(l=>r("li",{onClick:e=>{return a=l,void(tl.value.bgColor=a);var a}},["rgba(0,0,0,0)"===l?(o(),i("div",T,[l===tl.value.bgColor?(o(),i("b",q,"√")):k("",!0)])):(o(),i("div",{key:1,style:f({backgroundColor:l})},[l===tl.value.bgColor?(o(),i("b",F,"√")):k("",!0)],4))],8,P))),64)),d(U,{"show-alpha":"",modelValue:tl.value.bgColor,"onUpdate:modelValue":e[7]||(e[7]=l=>tl.value.bgColor=l)},null,8,["modelValue"])])])),_:1}),d(t,{label:"内嵌窗口"},{default:n((()=>[d(D,{"active-value":1,"inactive-value":0,modelValue:tl.value.app,"onUpdate:modelValue":e[8]||(e[8]=l=>tl.value.app=l)},null,8,["modelValue"]),J])),_:1}),"1"===p(al).state.site.is_push_link_store&&""===tl.value.id?(o(),w(t,{key:0,label:"推送标签"},{default:n((()=>[d(K,{checked:Boolean(parseInt(p(al).state.site.is_push_link_status)),modelValue:N.value,"onUpdate:modelValue":e[9]||(e[9]=l=>N.value=l)},{default:n((()=>[r("div",W,y(p(al).state.site.is_push_link_store_tips),1)])),_:1},8,["checked","modelValue"])])),_:1})):k("",!0)])),_:1},8,["label-position"]),r("div",A,[d(s,{type:"primary",size:"default",class:"w-full",onClick:il},{default:n((()=>[c("保存")])),_:1})])])])}}};export{D as default};
